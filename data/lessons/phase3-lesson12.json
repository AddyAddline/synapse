{
  "phase": 3,
  "order_num": 2,
  "title": "Filtering",
  "description": "Learn how to clean up brain signals using filters — removing noise, isolating specific brain wave rhythms, and understanding low-pass, high-pass, and band-pass filtering.",
  "difficulty": "intermediate",
  "estimated_minutes": 40,
  "content_md": "# Filtering\n\nImagine you're recording someone's brain waves during meditation. The EEG signal you get is a messy mixture of everything: the brain rhythms you care about, electrical noise from the room, muscle movements, and more. **Filtering** is how we clean up that signal to find what we're looking for.\n\n## What Is Filtering?\n\nA **filter** is a tool that selectively removes certain frequencies from a signal while keeping others. Think of it like a coffee filter — it lets the liquid through but catches the grounds. In our case, the \"liquid\" is the brain wave frequencies we want, and the \"grounds\" are the noise frequencies we don't.\n\n## Types of Filters\n\nThere are three main types:\n\n### 1. Low-Pass Filter\nLets **low frequencies pass** through, blocks high frequencies.\n- **Use case**: Removing high-frequency muscle noise from EEG\n- \"Keep everything below X Hz\"\n\n### 2. High-Pass Filter\nLets **high frequencies pass** through, blocks low frequencies.\n- **Use case**: Removing slow drift in the EEG signal (electrode movement)\n- \"Keep everything above X Hz\"\n\n### 3. Band-Pass Filter\nLets only a **specific range** (band) of frequencies through.\n- **Use case**: Isolating alpha waves (8-13 Hz) from everything else\n- \"Keep only frequencies between X and Y Hz\"\n\n## The Simplest Filter: Moving Average\n\nThe easiest filter to understand is the **moving average**. It works by replacing each data point with the average of its neighbors:\n\n```matlab\n% A noisy signal\nnoisy = [1, 5, 2, 8, 3, 7, 2, 6, 1, 5];\n\n% Moving average with window size 3\n% For each point, average it with its neighbors\nsmoothed = zeros(size(noisy));\nfor i = 2 : length(noisy) - 1\n    smoothed(i) = (noisy(i-1) + noisy(i) + noisy(i+1)) / 3;\nend\n% Handle edges\nsmoothed(1) = noisy(1);\nsmoothed(end) = noisy(end);\n```\n\nThe moving average is a **low-pass filter** — it smooths out rapid changes (high frequencies) while preserving slow trends (low frequencies). The larger the window, the more smoothing you get.\n\n## Using Convolution for Filtering\n\nA more elegant way to apply a moving average is using **convolution** with the `conv` function:\n\n```matlab\n% Create a moving average kernel (window)\nwindow_size = 5;\nkernel = ones(1, window_size) / window_size;  % e.g., [0.2, 0.2, 0.2, 0.2, 0.2]\n\n% Apply filter using convolution\nsmoothed = conv(signal, kernel, 'same');\n```\n\nThe `kernel` is like a recipe: `ones(1, 5) / 5` says \"take 5 points and average them equally.\" The `'same'` option keeps the output the same length as the input.\n\n## Building a Simple Low-Pass Filter\n\nFor a more proper low-pass filter, we can create a **sinc-based FIR filter** (Finite Impulse Response). Don't worry about the math — here's the intuition:\n\n- A low-pass filter with cutoff frequency `fc` keeps all frequencies below `fc`\n- We design a small \"kernel\" (a list of numbers) that does this\n- We apply it using `conv()`\n\n```matlab\n% Design a simple low-pass FIR filter\nfunction filtered = simple_lowpass(signal, Fs, cutoff_freq, filter_order)\n    % Normalized cutoff (0 to 1, where 1 = Nyquist)\n    fc = cutoff_freq / (Fs / 2);\n    \n    % Create sinc-based filter kernel\n    n = -(filter_order/2) : (filter_order/2);\n    kernel = sinc(2 * fc * n) .* (2 * fc);\n    \n    % Apply Hamming window to reduce artifacts\n    w = 0.54 - 0.46 * cos(2 * pi * (0:filter_order) / filter_order);\n    kernel = kernel .* w;\n    \n    % Normalize so gains sum to 1\n    kernel = kernel / sum(kernel);\n    \n    % Apply filter\n    filtered = conv(signal, kernel, 'same');\nend\n```\n\n## Band-Pass Filtering\n\nTo isolate a specific brain wave band (like alpha at 8-13 Hz), we use a **band-pass filter**. Conceptually, it's a combination of a high-pass (remove everything below 8 Hz) and a low-pass (remove everything above 13 Hz).\n\nA simple approach is to subtract two low-pass filtered versions of the signal:\n\n```matlab\n% Band-pass by subtracting two low-pass filters\nlow_part = simple_lowpass(signal, Fs, 13, 100);   % Keep below 13 Hz\nvery_low_part = simple_lowpass(signal, Fs, 8, 100); % Keep below 8 Hz\nalpha_band = low_part - very_low_part;              % What's left is 8-13 Hz!\n```\n\n## Why Filtering Matters in Neuroscience\n\nFiltering is one of the **most important preprocessing steps** in any EEG study:\n\n1. **High-pass at 0.1-1 Hz**: Removes slow electrode drift\n2. **Low-pass at 40-50 Hz**: Removes muscle noise and electrical interference\n3. **Notch filter at 50/60 Hz**: Removes power line noise\n4. **Band-pass for specific rhythms**: Isolate alpha/beta/theta for analysis\n\nEvery EEG paper you read will describe their filtering pipeline. Now you understand what they're doing!\n\n## Summary\n\n- **Filters** remove unwanted frequencies from signals\n- **Low-pass**: keeps low frequencies, removes high\n- **High-pass**: keeps high frequencies, removes low\n- **Band-pass**: keeps only a specific frequency range\n- **Moving average** is the simplest low-pass filter\n- **Convolution** (`conv`) is how we apply filters in code\n- Filtering is **essential** for cleaning EEG data before analysis",
  "exercises": [
    {
      "order_num": 1,
      "title": "Smooth a noisy brain signal",
      "prompt": "A neuroscience researcher has a noisy EEG recording. Apply a **moving average filter** to smooth it out.\n\n1. Create a noisy signal by combining a 5 Hz sine wave with random noise:\n   - Use `Fs = 256` and 1 second of data\n   - `clean = sin(2 * pi * 5 * t)`\n   - `noisy = clean + 0.5 * randn(size(t))`\n   - IMPORTANT: set the random seed first with `randn('state', 42)` so results are reproducible\n\n2. Create a moving average kernel of window size 15:\n   - `kernel = ones(1, 15) / 15`\n\n3. Apply the filter using convolution:\n   - `smoothed = conv(noisy, kernel, 'same')`\n\n4. Plot three subplots showing: (a) the clean signal, (b) the noisy signal, (c) the smoothed signal. Give each subplot a title.",
      "starter_code": "% Set random seed for reproducibility\nrandn('state', 42);\n\n% Parameters\nFs = 256;\nt = 0 : 1/Fs : 1 - 1/Fs;\n\n% Create clean signal (5 Hz sine wave)\n\n% Add noise\n\n% Create moving average kernel (window size 15)\n\n% Apply filter using conv()\n\n% Plot results in 3 subplots\n",
      "solution": "randn('state', 42);\nFs = 256;\nt = 0 : 1/Fs : 1 - 1/Fs;\nclean = sin(2 * pi * 5 * t);\nnoisy = clean + 0.5 * randn(size(t));\nkernel = ones(1, 15) / 15;\nsmoothed = conv(noisy, kernel, 'same');\nsubplot(3, 1, 1);\nplot(t, clean);\ntitle('Clean Signal (5 Hz)');\nsubplot(3, 1, 2);\nplot(t, noisy);\ntitle('Noisy Signal');\nsubplot(3, 1, 3);\nplot(t, smoothed);\ntitle('Smoothed Signal (Moving Average)');",
      "hints": [
        "Create the clean signal first: clean = sin(2 * pi * 5 * t). Then add noise: noisy = clean + 0.5 * randn(size(t)).",
        "The kernel for a moving average of size 15 is: kernel = ones(1, 15) / 15. Apply it with: smoothed = conv(noisy, kernel, 'same').",
        "For plotting use subplot(3,1,1); plot(t,clean); title('Clean Signal (5 Hz)'); then repeat for noisy and smoothed in subplot(3,1,2) and subplot(3,1,3)."
      ],
      "test_cases": [],
      "requires_plot": true
    },
    {
      "order_num": 2,
      "title": "Build a simple low-pass filter",
      "prompt": "Create a simple low-pass filter using a sinc function and apply it to remove high-frequency noise from an EEG signal.\n\n1. Define this function at the TOP of your code:\n```\nfunction filtered = simple_lowpass(signal, Fs, cutoff, order)\n    fc = cutoff / (Fs / 2);\n    n = -(order/2) : (order/2);\n    h = sinc(2 * fc * n) .* (2 * fc);\n    w = 0.54 - 0.46 * cos(2 * pi * (0:order) / order);\n    h = h .* w;\n    h = h / sum(h);\n    filtered = conv(signal, h, 'same');\nend\n```\n\n2. Then create a test signal: combine a 5 Hz wave (brain signal) + a 50 Hz wave (electrical noise), using `Fs = 256`, 1 second duration.\n\n3. Apply the low-pass filter with a cutoff of 20 Hz and filter order 80.\n\n4. Plot two subplots: (a) the original mixed signal, (b) the filtered signal (the 50 Hz noise should be removed!). Add titles to each.",
      "starter_code": "% Define the low-pass filter function FIRST\n\n% Then your main code below:\nFs = 256;\nt = 0 : 1/Fs : 1 - 1/Fs;\n\n% Create signal: 5 Hz brain wave + 50 Hz noise\n\n% Apply low-pass filter (cutoff = 20 Hz, order = 80)\n\n% Plot original and filtered signals\n",
      "solution": "function filtered = simple_lowpass(signal, Fs, cutoff, order)\n    fc = cutoff / (Fs / 2);\n    n = -(order/2) : (order/2);\n    h = sinc(2 * fc * n) .* (2 * fc);\n    w = 0.54 - 0.46 * cos(2 * pi * (0:order) / order);\n    h = h .* w;\n    h = h / sum(h);\n    filtered = conv(signal, h, 'same');\nend\n\nFs = 256;\nt = 0 : 1/Fs : 1 - 1/Fs;\nbrain_wave = sin(2 * pi * 5 * t);\nnoise = 0.5 * sin(2 * pi * 50 * t);\nmixed = brain_wave + noise;\nfiltered = simple_lowpass(mixed, Fs, 20, 80);\nsubplot(2, 1, 1);\nplot(t, mixed);\ntitle('Original Signal (5 Hz + 50 Hz noise)');\nsubplot(2, 1, 2);\nplot(t, filtered);\ntitle('After Low-Pass Filter (cutoff = 20 Hz)');",
      "hints": [
        "Put the function definition at the very top of your code. Then below it: brain_wave = sin(2*pi*5*t); noise = 0.5*sin(2*pi*50*t); mixed = brain_wave + noise;",
        "Apply the filter: filtered = simple_lowpass(mixed, Fs, 20, 80). The cutoff of 20 Hz means the 50 Hz noise gets removed but the 5 Hz brain wave stays.",
        "Plot with: subplot(2,1,1); plot(t, mixed); title('Original Signal (5 Hz + 50 Hz noise)'); subplot(2,1,2); plot(t, filtered); title('After Low-Pass Filter (cutoff = 20 Hz)');"
      ],
      "test_cases": [],
      "requires_plot": true
    },
    {
      "order_num": 3,
      "title": "Extract alpha waves with a band-pass filter",
      "prompt": "A researcher is studying alpha brain waves during a relaxation experiment. The EEG signal contains delta (2 Hz), alpha (10 Hz), and beta (25 Hz) components. Use band-pass filtering to extract ONLY the alpha waves (8-13 Hz).\n\n1. Define the `simple_lowpass` function at the TOP (same as previous exercise).\n\n2. Create a composite signal with three components:\n   - `delta = sin(2 * pi * 2 * t)` (amplitude 1)\n   - `alpha = 1.5 * sin(2 * pi * 10 * t)` (amplitude 1.5 — the strongest rhythm during relaxation!)\n   - `beta = 0.3 * sin(2 * pi * 25 * t)` (amplitude 0.3)\n   - `eeg = delta + alpha + beta`\n\n3. Band-pass filter (8-13 Hz) using the subtraction trick:\n   - `low_passed = simple_lowpass(eeg, Fs, 13, 100)` (keep everything below 13 Hz)\n   - `very_low_passed = simple_lowpass(eeg, Fs, 8, 100)` (keep everything below 8 Hz)\n   - `alpha_extracted = low_passed - very_low_passed` (what remains is 8-13 Hz!)\n\n4. Plot three subplots: (a) the full EEG signal, (b) the original alpha component, (c) the extracted alpha band. Add titles.",
      "starter_code": "% Define the low-pass filter function FIRST\n\n% Main code\nFs = 256;\nt = 0 : 1/Fs : 1 - 1/Fs;\n\n% Create composite EEG signal\n\n% Band-pass filter: subtract two low-pass filters\n\n% Plot results in 3 subplots\n",
      "solution": "function filtered = simple_lowpass(signal, Fs, cutoff, order)\n    fc = cutoff / (Fs / 2);\n    n = -(order/2) : (order/2);\n    h = sinc(2 * fc * n) .* (2 * fc);\n    w = 0.54 - 0.46 * cos(2 * pi * (0:order) / order);\n    h = h .* w;\n    h = h / sum(h);\n    filtered = conv(signal, h, 'same');\nend\n\nFs = 256;\nt = 0 : 1/Fs : 1 - 1/Fs;\ndelta = sin(2 * pi * 2 * t);\nalpha = 1.5 * sin(2 * pi * 10 * t);\nbeta = 0.3 * sin(2 * pi * 25 * t);\neeg = delta + alpha + beta;\nlow_passed = simple_lowpass(eeg, Fs, 13, 100);\nvery_low_passed = simple_lowpass(eeg, Fs, 8, 100);\nalpha_extracted = low_passed - very_low_passed;\nsubplot(3, 1, 1);\nplot(t, eeg);\ntitle('Full EEG Signal (delta + alpha + beta)');\nsubplot(3, 1, 2);\nplot(t, alpha);\ntitle('Original Alpha Component (10 Hz)');\nsubplot(3, 1, 3);\nplot(t, alpha_extracted);\ntitle('Extracted Alpha Band (8-13 Hz)');",
      "hints": [
        "Start by creating the three components: delta = sin(2*pi*2*t); alpha = 1.5*sin(2*pi*10*t); beta = 0.3*sin(2*pi*25*t); eeg = delta + alpha + beta;",
        "The band-pass trick: low_passed = simple_lowpass(eeg, Fs, 13, 100); very_low_passed = simple_lowpass(eeg, Fs, 8, 100); alpha_extracted = low_passed - very_low_passed;",
        "Plot with subplot(3,1,1); plot(t,eeg); title('Full EEG Signal (delta + alpha + beta)'); subplot(3,1,2); plot(t,alpha); title('Original Alpha Component (10 Hz)'); subplot(3,1,3); plot(t,alpha_extracted); title('Extracted Alpha Band (8-13 Hz)');"
      ],
      "test_cases": [],
      "requires_plot": true
    }
  ]
}
