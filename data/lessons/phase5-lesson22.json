{
  "phase": 5,
  "order_num": 2,
  "title": "Real EEG: Steady-State Visual Evoked Potentials",
  "description": "Load real human SSVEP EEG data, compute power spectra, and identify frequency-tagged brain responses.",
  "difficulty": "advanced",
  "estimated_minutes": 45,
  "content_md": "# Real EEG: Steady-State Visual Evoked Potentials\n\nIn this lesson you will work with **real human EEG data** — specifically, steady-state visual evoked potential (SSVEP) recordings.\n\n## What are SSVEPs?\n\nWhen you look at a light flickering at a constant frequency (say 15 Hz), your visual cortex generates a brain response **at that exact frequency**. This is an SSVEP.\n\nSSVEPs are remarkably robust and are used in:\n- **Brain-computer interfaces (BCIs):** different buttons flicker at different frequencies; the BCI detects which one you are looking at\n- **Attention research:** the SSVEP gets stronger when you pay attention to the flickering stimulus\n- **Clinical neuroscience:** testing visual pathway integrity\n\n## The Dataset\n\nThe file `ssvep_data.mat` contains a real SSVEP recording. The data typically includes:\n- Multi-channel EEG time series\n- Sampling rate information\n- Possibly trial/condition markers\n\nThis data comes from Mike X Cohen's course materials.\n\n## The Analysis Plan\n\n1. Load and inspect the data structure\n2. Examine the raw EEG time series\n3. Compute the power spectrum using FFT\n4. Identify the SSVEP peak — a sharp spike at the stimulation frequency\n\n## Why SSVEPs are Great for Learning\n\nSSVEP data gives you a **clear, unambiguous signal** to find. Unlike many brain signals that are subtle and require statistical techniques to detect, an SSVEP peak jumps right out of the power spectrum. This makes it perfect for practicing spectral analysis on real data.\n\nLet's find some brain responses!",
  "exercises": [
    {
      "order_num": 1,
      "title": "Load and inspect SSVEP EEG data",
      "prompt": "Load the SSVEP EEG dataset and explore its structure.\n\n1. Set the data path and load ssvep_data.mat\n2. Display all field names\n3. For each field, display: name, class (using class()), and size\n4. Look for a field that could be the sampling rate (usually a scalar) and display it\n5. Look for the main EEG data matrix (usually the largest 2D matrix) and display its size\n6. Display: 'Channels: X, Timepoints: Y' based on the data matrix dimensions (assume channels are rows if the matrix has fewer rows than columns, otherwise columns)",
      "starter_code": "% Load and inspect real SSVEP EEG data\nNEURO_DATA = '/usr/share/neuroscience-data';\ndata = load([NEURO_DATA '/ssvep_data.mat']);\n\n% Display all fields with their class and size\nfnames = fieldnames(data);\n% YOUR CODE HERE\n\n% Find sampling rate (scalar numeric field)\n% YOUR CODE HERE\n\n% Find main EEG data matrix\n% YOUR CODE HERE\n",
      "solution": "NEURO_DATA = '/usr/share/neuroscience-data';\ndata = load([NEURO_DATA '/ssvep_data.mat']);\n\nfnames = fieldnames(data);\ndisp('=== Data Structure ===');\nfor i = 1:length(fnames)\n  name = fnames{i};\n  val = data.(name);\n  disp([name ' | class: ' class(val) ' | size: ' num2str(size(val))]);\nend\n\ndisp('');\ndisp('=== Looking for sampling rate ===');\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && isscalar(val)\n    disp([fnames{i} ' = ' num2str(val) ' (scalar — possible sampling rate)']);\n  end\nend\n\ndisp('');\ndisp('=== Looking for EEG data matrix ===');\nmax_numel = 0;\neeg_field = '';\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && ndims(val) == 2 && numel(val) > max_numel\n    max_numel = numel(val);\n    eeg_field = fnames{i};\n  end\nend\n\nif ~isempty(eeg_field)\n  eeg = data.(eeg_field);\n  disp(['EEG field: ' eeg_field ' | size: ' num2str(size(eeg))]);\n  [r, c] = size(eeg);\n  if r < c\n    disp(['Channels: ' num2str(r) ', Timepoints: ' num2str(c)]);\n  else\n    disp(['Channels: ' num2str(c) ', Timepoints: ' num2str(r)]);\n  end\nend",
      "hints": [
        "Use class(val) to get the data type of each field (double, char, struct, etc.).",
        "A scalar numeric field (numel == 1) is likely the sampling rate.",
        "The EEG data is usually the largest 2D numeric matrix in the file."
      ],
      "test_cases": [],
      "requires_plot": false
    },
    {
      "order_num": 2,
      "title": "Compute the power spectrum of real EEG",
      "prompt": "Compute the power spectrum of the SSVEP EEG data to find frequency-tagged brain responses.\n\n1. Load ssvep_data.mat\n2. Find the main EEG matrix (largest 2D numeric field) and the sampling rate (scalar numeric field). If no scalar is found, assume fs = 1000.\n3. Extract the first channel (first row if channels are rows, first column otherwise)\n4. Compute the FFT and power spectrum: power = abs(fft_result(1:N/2+1)).^2 / N\n5. Create frequency axis: freqs = (0:N/2) * fs / N\n6. Plot the power spectrum from 1 to 80 Hz\n   - Title: 'Power Spectrum - SSVEP EEG (Channel 1)'\n   - xlabel: 'Frequency (Hz)', ylabel: 'Power'\n7. Find the peak frequency between 5 and 50 Hz and display it:\n   disp(['Peak frequency: ' num2str(peak_freq) ' Hz'])",
      "starter_code": "% Power spectrum of real SSVEP EEG\nNEURO_DATA = '/usr/share/neuroscience-data';\ndata = load([NEURO_DATA '/ssvep_data.mat']);\n\n% Find EEG matrix and sampling rate\nfnames = fieldnames(data);\n% YOUR CODE HERE\n\n% Extract first channel\n% YOUR CODE HERE\n\n% Compute FFT and power spectrum\n% YOUR CODE HERE\n\n% Plot 1-80 Hz\nfigure;\n% YOUR CODE HERE\n\n% Find and display peak frequency\n% YOUR CODE HERE\n",
      "solution": "NEURO_DATA = '/usr/share/neuroscience-data';\ndata = load([NEURO_DATA '/ssvep_data.mat']);\n\nfnames = fieldnames(data);\n\nfs = 1000;\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && isscalar(val) && val > 0\n    fs = val;\n    break;\n  end\nend\ndisp(['Sampling rate: ' num2str(fs) ' Hz']);\n\nmax_numel = 0;\neeg_field = '';\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && ndims(val) == 2 && numel(val) > max_numel\n    max_numel = numel(val);\n    eeg_field = fnames{i};\n  end\nend\n\neeg = data.(eeg_field);\n[r, c] = size(eeg);\nif r < c\n  channel1 = eeg(1, :);\nelse\n  channel1 = eeg(:, 1)';\nend\n\nN = length(channel1);\nfft_result = fft(channel1);\npower = abs(fft_result(1:N/2+1)).^2 / N;\nfreqs = (0:N/2) * fs / N;\n\nplot_idx = freqs >= 1 & freqs <= 80;\n\nfigure;\nplot(freqs(plot_idx), power(plot_idx), 'b-', 'LineWidth', 1.2);\nxlabel('Frequency (Hz)');\nylabel('Power');\ntitle('Power Spectrum - SSVEP EEG (Channel 1)');\n\nsearch_idx = freqs >= 5 & freqs <= 50;\nsearch_power = power;\nsearch_power(~search_idx) = 0;\n[~, peak_bin] = max(search_power);\npeak_freq = freqs(peak_bin);\ndisp(['Peak frequency: ' num2str(peak_freq) ' Hz']);",
      "hints": [
        "To find the sampling rate, loop through fields and check: isnumeric(val) && isscalar(val).",
        "If channels are rows (fewer rows than columns), first channel = eeg(1,:).",
        "For peak finding: zero out the power outside 5-50 Hz, then use max() to find the peak."
      ],
      "test_cases": [],
      "requires_plot": true
    },
    {
      "order_num": 3,
      "title": "Compare power spectra across channels",
      "prompt": "Compare the power spectra across multiple EEG channels to see how the SSVEP response varies across the scalp.\n\n1. Load ssvep_data.mat, find the EEG matrix and sampling rate (default 1000 Hz)\n2. Determine the number of channels (min dimension of the EEG matrix). Use at most 6 channels: num_ch = min(num_channels, 6)\n3. For each channel, compute the power spectrum\n4. Create a figure with num_ch subplots (arranged as num_ch x 1):\n   - Each subplot: plot power spectrum from 1-60 Hz\n   - Title each: ['Channel ' num2str(ch)]\n   - ylabel: 'Power'\n   - Only add xlabel 'Frequency (Hz)' to the bottom subplot\n5. Main title: 'SSVEP Power Spectra Across Channels'\n6. After plotting, find the peak frequency (5-50 Hz) for each channel and display:\n   disp(['Channel ' num2str(ch) ' peak: ' num2str(peak_freq) ' Hz'])",
      "starter_code": "% Compare SSVEP power across channels\nNEURO_DATA = '/usr/share/neuroscience-data';\ndata = load([NEURO_DATA '/ssvep_data.mat']);\n\n% Find EEG matrix and sampling rate\nfnames = fieldnames(data);\nfs = 1000;\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && isscalar(val) && val > 0\n    fs = val; break;\n  end\nend\n\nmax_numel = 0; eeg_field = '';\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && ndims(val) == 2 && numel(val) > max_numel\n    max_numel = numel(val); eeg_field = fnames{i};\n  end\nend\neeg = data.(eeg_field);\n\n% Determine channels\n[r, c] = size(eeg);\nif r < c\n  num_channels = r;\nelse\n  num_channels = c;\n  eeg = eeg';  % transpose so channels are rows\nend\nnum_ch = min(num_channels, 6);\n\n% Compute and plot power spectra\nfigure;\n% YOUR CODE HERE\n\n% Display peak frequencies\n% YOUR CODE HERE\n",
      "solution": "NEURO_DATA = '/usr/share/neuroscience-data';\ndata = load([NEURO_DATA '/ssvep_data.mat']);\n\nfnames = fieldnames(data);\nfs = 1000;\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && isscalar(val) && val > 0\n    fs = val; break;\n  end\nend\n\nmax_numel = 0; eeg_field = '';\nfor i = 1:length(fnames)\n  val = data.(fnames{i});\n  if isnumeric(val) && ndims(val) == 2 && numel(val) > max_numel\n    max_numel = numel(val); eeg_field = fnames{i};\n  end\nend\neeg = data.(eeg_field);\n\n[r, c] = size(eeg);\nif r < c\n  num_channels = r;\nelse\n  num_channels = c;\n  eeg = eeg';\nend\nnum_ch = min(num_channels, 6);\n\nN = size(eeg, 2);\nfreqs = (0:N/2) * fs / N;\nplot_idx = freqs >= 1 & freqs <= 60;\nsearch_idx = freqs >= 5 & freqs <= 50;\n\nfigure;\nfor ch = 1:num_ch\n  fft_result = fft(eeg(ch, :));\n  power = abs(fft_result(1:N/2+1)).^2 / N;\n\n  subplot(num_ch, 1, ch);\n  plot(freqs(plot_idx), power(plot_idx), 'LineWidth', 1);\n  ylabel('Power');\n  title(['Channel ' num2str(ch)]);\n  if ch == num_ch\n    xlabel('Frequency (Hz)');\n  end\nend\nsgtitle('SSVEP Power Spectra Across Channels');\n\ndisp('=== Peak Frequencies ===');\nfor ch = 1:num_ch\n  fft_result = fft(eeg(ch, :));\n  power = abs(fft_result(1:N/2+1)).^2 / N;\n  search_power = power;\n  search_power(~search_idx) = 0;\n  [~, peak_bin] = max(search_power);\n  disp(['Channel ' num2str(ch) ' peak: ' num2str(freqs(peak_bin)) ' Hz']);\nend",
      "hints": [
        "Loop from ch = 1:num_ch. For each channel: fft_result = fft(eeg(ch,:)); power = abs(fft_result(1:N/2+1)).^2 / N;",
        "Use subplot(num_ch, 1, ch) to stack plots vertically.",
        "For peak finding per channel, recompute the power and mask outside 5-50 Hz."
      ],
      "test_cases": [],
      "requires_plot": true
    }
  ]
}
