{
  "phase": 4,
  "order_num": 6,
  "title": "Capstone: Meditation EEG Study",
  "description": "Bring it all together — build a complete EEG analysis pipeline from data simulation to publication-quality figures for a meditation study.",
  "difficulty": "advanced",
  "estimated_minutes": 60,
  "content_md": "# Capstone: Meditation EEG Study\n\nThis is it — the final lesson. Everything you have learned across all four phases comes together here.\n\nYou are going to build a **complete analysis pipeline** for a simulated meditation EEG study, just like the one your friend might run in their lab. By the end of this lesson, you will have:\n\n1. Generated realistic multi-channel, multi-condition EEG data\n2. Preprocessed it (referencing, artifact removal)\n3. Performed spectral analysis across frequency bands\n4. Compared meditation vs. baseline conditions\n5. Created a publication-quality figure showing the results\n\nThis is a real-world workflow. The only difference between this and an actual study is that we simulate the data instead of loading it from a recording system.\n\n## The Study Design\n\nImagine this experiment:\n- **Participants:** 1 (for simplicity, but real studies have 20+)\n- **Channels:** 4 EEG electrodes (Fz, Cz, Pz, Oz — frontal, central, parietal, occipital)\n- **Conditions:** Baseline (eyes closed, resting) and Meditation (guided meditation)\n- **Duration:** 60 seconds per condition\n- **Hypothesis:** Alpha power (8-13 Hz) increases during meditation, especially at posterior electrodes (Pz, Oz)\n\n## What Makes This a Capstone?\n\nEach exercise in this lesson pulls from skills you learned earlier:\n\n- **Phase 1:** Variables, loops, arrays — building the simulation\n- **Phase 2:** Matrix operations, functions — organizing the pipeline\n- **Phase 3:** FFT, filtering, plotting — the core analysis\n- **Phase 4:** EEG preprocessing, spectral analysis, neuroscience interpretation\n\n## Tips for the Exercises\n\n- These exercises are longer than previous ones. Take your time.\n- Read the full prompt before starting to code.\n- Build incrementally: get one section working, then add the next.\n- Use the hints if you get stuck — there is no shame in that.\n\nLet's do this.",
  "exercises": [
    {
      "order_num": 1,
      "title": "Build a complete preprocessing pipeline",
      "prompt": "Build a complete EEG preprocessing pipeline for a simulated meditation study.\n\nSteps:\n1. Use rng(200). Set fs = 256, duration = 60 seconds per condition.\n2. Define 4 channels: Fz, Cz, Pz, Oz.\n3. Simulate BASELINE data (4 channels x samples):\n   - All channels: alpha (10 Hz) amplitude [5, 6, 8, 9] per channel + beta (20 Hz) amplitude 7 + theta (6 Hz) amplitude 3 + noise std 4\n4. Simulate MEDITATION data (4 channels x samples):\n   - All channels: alpha (10 Hz) amplitude [10, 14, 22, 25] per channel + beta (20 Hz) amplitude 3 + theta (6 Hz) amplitude 10 + noise std 3\n5. Insert 5 blink artifacts in each condition at random positions in channel 1 (Fz): add 200 uV for 50 samples each. Use artifact_starts_base = sort(randi([100, num_samples-100], 1, 5)) for baseline, then artifact_starts_med = sort(randi([100, num_samples-100], 1, 5)) for meditation.\n6. Apply average reference to both conditions.\n7. Detect artifacts: any time point where any channel exceeds abs > 60 uV. Create a clean version by setting artifact time points to 0 across all channels.\n8. Create a 2x2 subplot figure showing:\n   - (1,1): Raw baseline Fz channel — title: 'Baseline - Raw (Fz)'\n   - (1,2): Clean baseline Fz channel — title: 'Baseline - Cleaned (Fz)'\n   - (2,1): Raw meditation Fz channel — title: 'Meditation - Raw (Fz)'\n   - (2,2): Clean meditation Fz channel — title: 'Meditation - Cleaned (Fz)'\n   - All subplots: xlabel 'Time (s)', ylabel 'Voltage (uV)'\n   - Main title: 'Preprocessing Pipeline: Meditation EEG Study'",
      "starter_code": "% Capstone Exercise 1: Complete preprocessing pipeline\nrng(200);\n\nfs = 256;\nduration = 60;\nt = 0:1/fs:duration-1/fs;\nnum_samples = length(t);\nchannel_names = {'Fz', 'Cz', 'Pz', 'Oz'};\nnum_channels = 4;\n\n% Alpha amplitudes per channel\nalpha_amp_base = [5, 6, 8, 9];\nalpha_amp_med = [10, 14, 22, 25];\n\n% Simulate baseline data\nbaseline = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  % YOUR CODE HERE\nend\n\n% Simulate meditation data\nmeditation = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  % YOUR CODE HERE\nend\n\n% Insert blink artifacts in Fz (channel 1)\nartifact_starts_base = sort(randi([100, num_samples-100], 1, 5));\n% YOUR CODE HERE\n\nartifact_starts_med = sort(randi([100, num_samples-100], 1, 5));\n% YOUR CODE HERE\n\n% Save raw copies for plotting\nbaseline_raw = baseline;\nmeditation_raw = meditation;\n\n% Average reference\n% YOUR CODE HERE\n\n% Artifact detection and cleaning (threshold = 60 uV)\nthreshold = 60;\n% YOUR CODE HERE\n\n% Plot 2x2 figure\nfigure;\n% YOUR CODE HERE\n",
      "solution": "rng(200);\n\nfs = 256;\nduration = 60;\nt = 0:1/fs:duration-1/fs;\nnum_samples = length(t);\nchannel_names = {'Fz', 'Cz', 'Pz', 'Oz'};\nnum_channels = 4;\n\nalpha_amp_base = [5, 6, 8, 9];\nalpha_amp_med = [10, 14, 22, 25];\n\nbaseline = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  baseline(ch,:) = alpha_amp_base(ch)*sin(2*pi*10*t) + 7*sin(2*pi*20*t) + 3*sin(2*pi*6*t) + 4*randn(1, num_samples);\nend\n\nmeditation = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  meditation(ch,:) = alpha_amp_med(ch)*sin(2*pi*10*t) + 3*sin(2*pi*20*t) + 10*sin(2*pi*6*t) + 3*randn(1, num_samples);\nend\n\nartifact_starts_base = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_base(a):artifact_starts_base(a)+49;\n  baseline(1, idx) = baseline(1, idx) + 200;\nend\n\nartifact_starts_med = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_med(a):artifact_starts_med(a)+49;\n  meditation(1, idx) = meditation(1, idx) + 200;\nend\n\nbaseline_raw = baseline;\nmeditation_raw = meditation;\n\navg_ref_base = mean(baseline, 1);\nbaseline = baseline - avg_ref_base;\n\navg_ref_med = mean(meditation, 1);\nmeditation = meditation - avg_ref_med;\n\nthreshold = 60;\nart_mask_base = any(abs(baseline) > threshold, 1);\nbaseline(:, art_mask_base) = 0;\n\nart_mask_med = any(abs(meditation) > threshold, 1);\nmeditation(:, art_mask_med) = 0;\n\nfigure;\nsubplot(2,2,1);\nplot(t, baseline_raw(1,:));\nxlabel('Time (s)'); ylabel('Voltage (uV)');\ntitle('Baseline - Raw (Fz)');\n\nsubplot(2,2,2);\nplot(t, baseline(1,:));\nxlabel('Time (s)'); ylabel('Voltage (uV)');\ntitle('Baseline - Cleaned (Fz)');\n\nsubplot(2,2,3);\nplot(t, meditation_raw(1,:));\nxlabel('Time (s)'); ylabel('Voltage (uV)');\ntitle('Meditation - Raw (Fz)');\n\nsubplot(2,2,4);\nplot(t, meditation(1,:));\nxlabel('Time (s)'); ylabel('Voltage (uV)');\ntitle('Meditation - Cleaned (Fz)');\n\nsgtitle('Preprocessing Pipeline: Meditation EEG Study');",
      "hints": [
        "For simulation: baseline(ch,:) = alpha_amp_base(ch)*sin(2*pi*10*t) + 7*sin(2*pi*20*t) + 3*sin(2*pi*6*t) + 4*randn(1, num_samples); Same pattern for meditation with different amplitudes.",
        "For artifacts: for a = 1:5, idx = artifact_starts_base(a):artifact_starts_base(a)+49; baseline(1, idx) = baseline(1, idx) + 200; end. Average reference: avg_ref = mean(baseline, 1); baseline = baseline - avg_ref;",
        "Artifact detection: art_mask_base = any(abs(baseline) > threshold, 1); baseline(:, art_mask_base) = 0; Plot with subplot(2,2,1), etc. Use sgtitle for the main title."
      ],
      "test_cases": [],
      "requires_plot": true
    },
    {
      "order_num": 2,
      "title": "Spectral analysis: meditation vs baseline",
      "prompt": "Perform spectral analysis on the simulated meditation EEG data to compare frequency band power between conditions.\n\nSteps:\n1. Use rng(200). Regenerate the same data as Exercise 1 (same simulation, artifacts, referencing, cleaning).\n2. For each channel and each condition, compute the power spectrum using FFT on the cleaned data.\n3. Compute band power for each channel in both conditions:\n   - Theta (4-8 Hz)\n   - Alpha (8-13 Hz)\n   - Beta (13-30 Hz)\n4. Create a figure with 2 subplots (side by side):\n   - Left subplot: grouped bar chart of alpha power by channel for baseline (blue) and meditation (red). Title: 'Alpha Power by Channel'. Ylabel: 'Power (uV^2)'. Set XTickLabel to channel names.\n   - Right subplot: grouped bar chart showing all three bands (theta, alpha, beta) averaged across channels for both conditions. Title: 'Band Power: Baseline vs Meditation'. Ylabel: 'Power (uV^2)'. Set XTickLabel to band names.\n   - Main title: 'Spectral Analysis: Meditation vs Baseline'\n   - Add legends to both subplots: 'Baseline', 'Meditation'",
      "starter_code": "% Capstone Exercise 2: Spectral analysis\nrng(200);\n\nfs = 256;\nduration = 60;\nt = 0:1/fs:duration-1/fs;\nnum_samples = length(t);\nchannel_names = {'Fz', 'Cz', 'Pz', 'Oz'};\nnum_channels = 4;\nalpha_amp_base = [5, 6, 8, 9];\nalpha_amp_med = [10, 14, 22, 25];\n\n% --- Regenerate and preprocess (same as Exercise 1) ---\nbaseline = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  baseline(ch,:) = alpha_amp_base(ch)*sin(2*pi*10*t) + 7*sin(2*pi*20*t) + 3*sin(2*pi*6*t) + 4*randn(1, num_samples);\nend\nmeditation = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  meditation(ch,:) = alpha_amp_med(ch)*sin(2*pi*10*t) + 3*sin(2*pi*20*t) + 10*sin(2*pi*6*t) + 3*randn(1, num_samples);\nend\nartifact_starts_base = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_base(a):artifact_starts_base(a)+49;\n  baseline(1, idx) = baseline(1, idx) + 200;\nend\nartifact_starts_med = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_med(a):artifact_starts_med(a)+49;\n  meditation(1, idx) = meditation(1, idx) + 200;\nend\navg_ref_base = mean(baseline, 1); baseline = baseline - avg_ref_base;\navg_ref_med = mean(meditation, 1); meditation = meditation - avg_ref_med;\nthreshold = 60;\nart_mask_base = any(abs(baseline) > threshold, 1); baseline(:, art_mask_base) = 0;\nart_mask_med = any(abs(meditation) > threshold, 1); meditation(:, art_mask_med) = 0;\n% --- End preprocessing ---\n\n% Compute power spectra per channel\nN = num_samples;\nfreqs = (0:N/2) * fs / N;\n\ntheta_idx = freqs >= 4 & freqs < 8;\nalpha_idx = freqs >= 8 & freqs <= 13;\nbeta_idx = freqs > 13 & freqs <= 30;\n\n% Store band power for each channel\nalpha_base = zeros(1, num_channels);\nalpha_med = zeros(1, num_channels);\ntheta_base = zeros(1, num_channels);\ntheta_med = zeros(1, num_channels);\nbeta_base = zeros(1, num_channels);\nbeta_med = zeros(1, num_channels);\n\nfor ch = 1:num_channels\n  % Compute power spectra for this channel\n  % YOUR CODE HERE\n\n  % Extract band powers\n  % YOUR CODE HERE\nend\n\n% Create figure\nfigure;\n% YOUR CODE HERE\n",
      "solution": "rng(200);\n\nfs = 256;\nduration = 60;\nt = 0:1/fs:duration-1/fs;\nnum_samples = length(t);\nchannel_names = {'Fz', 'Cz', 'Pz', 'Oz'};\nnum_channels = 4;\nalpha_amp_base = [5, 6, 8, 9];\nalpha_amp_med = [10, 14, 22, 25];\n\nbaseline = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  baseline(ch,:) = alpha_amp_base(ch)*sin(2*pi*10*t) + 7*sin(2*pi*20*t) + 3*sin(2*pi*6*t) + 4*randn(1, num_samples);\nend\nmeditation = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  meditation(ch,:) = alpha_amp_med(ch)*sin(2*pi*10*t) + 3*sin(2*pi*20*t) + 10*sin(2*pi*6*t) + 3*randn(1, num_samples);\nend\nartifact_starts_base = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_base(a):artifact_starts_base(a)+49;\n  baseline(1, idx) = baseline(1, idx) + 200;\nend\nartifact_starts_med = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_med(a):artifact_starts_med(a)+49;\n  meditation(1, idx) = meditation(1, idx) + 200;\nend\navg_ref_base = mean(baseline, 1); baseline = baseline - avg_ref_base;\navg_ref_med = mean(meditation, 1); meditation = meditation - avg_ref_med;\nthreshold = 60;\nart_mask_base = any(abs(baseline) > threshold, 1); baseline(:, art_mask_base) = 0;\nart_mask_med = any(abs(meditation) > threshold, 1); meditation(:, art_mask_med) = 0;\n\nN = num_samples;\nfreqs = (0:N/2) * fs / N;\n\ntheta_idx = freqs >= 4 & freqs < 8;\nalpha_idx = freqs >= 8 & freqs <= 13;\nbeta_idx = freqs > 13 & freqs <= 30;\n\nalpha_base = zeros(1, num_channels);\nalpha_med = zeros(1, num_channels);\ntheta_base = zeros(1, num_channels);\ntheta_med = zeros(1, num_channels);\nbeta_base = zeros(1, num_channels);\nbeta_med = zeros(1, num_channels);\n\nfor ch = 1:num_channels\n  fft_base = fft(baseline(ch,:));\n  power_base = (abs(fft_base(1:N/2+1)).^2) / N;\n\n  fft_med = fft(meditation(ch,:));\n  power_med = (abs(fft_med(1:N/2+1)).^2) / N;\n\n  alpha_base(ch) = sum(power_base(alpha_idx));\n  alpha_med(ch) = sum(power_med(alpha_idx));\n  theta_base(ch) = sum(power_base(theta_idx));\n  theta_med(ch) = sum(power_med(theta_idx));\n  beta_base(ch) = sum(power_base(beta_idx));\n  beta_med(ch) = sum(power_med(beta_idx));\nend\n\nfigure;\nsubplot(1,2,1);\nalpha_data = [alpha_base; alpha_med]';\nbar(alpha_data);\nset(gca, 'XTickLabel', channel_names);\nylabel('Power (uV^2)');\ntitle('Alpha Power by Channel');\nlegend('Baseline', 'Meditation');\n\nsubplot(1,2,2);\nband_base_avg = [mean(theta_base), mean(alpha_base), mean(beta_base)];\nband_med_avg = [mean(theta_med), mean(alpha_med), mean(beta_med)];\nband_data = [band_base_avg; band_med_avg]';\nbar(band_data);\nset(gca, 'XTickLabel', {'Theta', 'Alpha', 'Beta'});\nylabel('Power (uV^2)');\ntitle('Band Power: Baseline vs Meditation');\nlegend('Baseline', 'Meditation');\n\nsgtitle('Spectral Analysis: Meditation vs Baseline');",
      "hints": [
        "For each channel: fft_base = fft(baseline(ch,:)); power_base = (abs(fft_base(1:N/2+1)).^2)/N; Same for meditation. Then extract bands: alpha_base(ch) = sum(power_base(alpha_idx));",
        "For the left subplot: create a matrix alpha_data = [alpha_base; alpha_med]'; then bar(alpha_data); set(gca, 'XTickLabel', channel_names);",
        "For the right subplot: average across channels: band_base_avg = [mean(theta_base), mean(alpha_base), mean(beta_base)]; band_data = [band_base_avg; band_med_avg]'; bar(band_data); set(gca, 'XTickLabel', {'Theta', 'Alpha', 'Beta'});"
      ],
      "test_cases": [],
      "requires_plot": true
    },
    {
      "order_num": 3,
      "title": "Create a publication-quality figure",
      "prompt": "Create a polished, publication-quality multi-panel figure that summarizes the complete meditation EEG study results.\n\nRegenerate the same data (rng(200), same pipeline as Exercises 1-2). Then create a figure with 6 panels (3 rows x 2 columns):\n\n**Row 1: Power Spectra**\n- (1,1): Power spectrum (1-40 Hz) for Oz channel — baseline. Shade alpha band (8-13 Hz) in light blue. Title: 'Baseline Power Spectrum (Oz)'. Ylabel: 'Power (uV^2)'. Xlabel: 'Frequency (Hz)'.\n- (1,2): Power spectrum (1-40 Hz) for Oz channel — meditation. Shade alpha band in light red. Title: 'Meditation Power Spectrum (Oz)'. Same axis labels.\n\n**Row 2: Topographic-style Bar Comparisons**\n- (2,1): Grouped bar chart of alpha power per channel (baseline vs meditation). Title: 'Alpha Power by Channel'. Legend: 'Baseline', 'Meditation'.\n- (2,2): Bar chart showing percentage change in alpha power per channel. Title: 'Alpha Power Change (%)'. Color bars green. Add a horizontal dashed line at 0.\n\n**Row 3: Summary**\n- (3,1): Grouped bar chart of all bands (theta, alpha, beta) averaged across all channels. Title: 'Average Band Power'. Legend: 'Baseline', 'Meditation'.\n- (3,2): Text summary panel. Use text() to display key findings:\n  - 'Meditation EEG Study Results' (bold-style, larger)\n  - The mean alpha power change across channels (rounded to 1 decimal)\n  - The channel with maximum alpha increase\n  - Set axis off. Title: 'Summary'.\n\nMain figure title: 'Meditation EEG Study: Complete Results'\n\nMake the figure large: set figure position to [50, 50, 1200, 900].",
      "starter_code": "% Capstone Exercise 3: Publication-quality figure\nrng(200);\n\nfs = 256;\nduration = 60;\nt = 0:1/fs:duration-1/fs;\nnum_samples = length(t);\nchannel_names = {'Fz', 'Cz', 'Pz', 'Oz'};\nnum_channels = 4;\nalpha_amp_base = [5, 6, 8, 9];\nalpha_amp_med = [10, 14, 22, 25];\n\n% --- Full pipeline: simulate, artifact, reference, clean ---\nbaseline = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  baseline(ch,:) = alpha_amp_base(ch)*sin(2*pi*10*t) + 7*sin(2*pi*20*t) + 3*sin(2*pi*6*t) + 4*randn(1, num_samples);\nend\nmeditation = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  meditation(ch,:) = alpha_amp_med(ch)*sin(2*pi*10*t) + 3*sin(2*pi*20*t) + 10*sin(2*pi*6*t) + 3*randn(1, num_samples);\nend\nartifact_starts_base = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_base(a):artifact_starts_base(a)+49;\n  baseline(1, idx) = baseline(1, idx) + 200;\nend\nartifact_starts_med = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_med(a):artifact_starts_med(a)+49;\n  meditation(1, idx) = meditation(1, idx) + 200;\nend\navg_ref_base = mean(baseline, 1); baseline = baseline - avg_ref_base;\navg_ref_med = mean(meditation, 1); meditation = meditation - avg_ref_med;\nthreshold = 60;\nart_mask_base = any(abs(baseline) > threshold, 1); baseline(:, art_mask_base) = 0;\nart_mask_med = any(abs(meditation) > threshold, 1); meditation(:, art_mask_med) = 0;\n\n% --- Compute spectra and band powers ---\nN = num_samples;\nfreqs = (0:N/2) * fs / N;\ntheta_idx = freqs >= 4 & freqs < 8;\nalpha_idx = freqs >= 8 & freqs <= 13;\nbeta_idx = freqs > 13 & freqs <= 30;\nplot_idx = freqs >= 1 & freqs <= 40;\n\nalpha_base = zeros(1, num_channels);\nalpha_med = zeros(1, num_channels);\ntheta_base = zeros(1, num_channels);\ntheta_med = zeros(1, num_channels);\nbeta_base = zeros(1, num_channels);\nbeta_med = zeros(1, num_channels);\n\npower_base_all = zeros(num_channels, sum(freqs >= 0 & freqs <= fs/2));\npower_med_all = zeros(num_channels, sum(freqs >= 0 & freqs <= fs/2));\n\nfor ch = 1:num_channels\n  fft_base = fft(baseline(ch,:));\n  pb = (abs(fft_base(1:N/2+1)).^2) / N;\n  power_base_all(ch,:) = pb;\n\n  fft_med = fft(meditation(ch,:));\n  pm = (abs(fft_med(1:N/2+1)).^2) / N;\n  power_med_all(ch,:) = pm;\n\n  alpha_base(ch) = sum(pb(alpha_idx));\n  alpha_med(ch) = sum(pm(alpha_idx));\n  theta_base(ch) = sum(pb(theta_idx));\n  theta_med(ch) = sum(pm(theta_idx));\n  beta_base(ch) = sum(pb(beta_idx));\n  beta_med(ch) = sum(pm(beta_idx));\nend\n\nalpha_change_pct = (alpha_med - alpha_base) ./ alpha_base * 100;\n\n% --- Create publication-quality figure ---\nfigure('Position', [50, 50, 1200, 900]);\n\n% Row 1: Power spectra for Oz (channel 4)\n% YOUR CODE HERE\n\n% Row 2: Alpha comparisons\n% YOUR CODE HERE\n\n% Row 3: Summary\n% YOUR CODE HERE\n\nsgtitle('Meditation EEG Study: Complete Results');\n",
      "solution": "rng(200);\n\nfs = 256;\nduration = 60;\nt = 0:1/fs:duration-1/fs;\nnum_samples = length(t);\nchannel_names = {'Fz', 'Cz', 'Pz', 'Oz'};\nnum_channels = 4;\nalpha_amp_base = [5, 6, 8, 9];\nalpha_amp_med = [10, 14, 22, 25];\n\nbaseline = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  baseline(ch,:) = alpha_amp_base(ch)*sin(2*pi*10*t) + 7*sin(2*pi*20*t) + 3*sin(2*pi*6*t) + 4*randn(1, num_samples);\nend\nmeditation = zeros(num_channels, num_samples);\nfor ch = 1:num_channels\n  meditation(ch,:) = alpha_amp_med(ch)*sin(2*pi*10*t) + 3*sin(2*pi*20*t) + 10*sin(2*pi*6*t) + 3*randn(1, num_samples);\nend\nartifact_starts_base = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_base(a):artifact_starts_base(a)+49;\n  baseline(1, idx) = baseline(1, idx) + 200;\nend\nartifact_starts_med = sort(randi([100, num_samples-100], 1, 5));\nfor a = 1:5\n  idx = artifact_starts_med(a):artifact_starts_med(a)+49;\n  meditation(1, idx) = meditation(1, idx) + 200;\nend\navg_ref_base = mean(baseline, 1); baseline = baseline - avg_ref_base;\navg_ref_med = mean(meditation, 1); meditation = meditation - avg_ref_med;\nthreshold = 60;\nart_mask_base = any(abs(baseline) > threshold, 1); baseline(:, art_mask_base) = 0;\nart_mask_med = any(abs(meditation) > threshold, 1); meditation(:, art_mask_med) = 0;\n\nN = num_samples;\nfreqs = (0:N/2) * fs / N;\ntheta_idx = freqs >= 4 & freqs < 8;\nalpha_idx = freqs >= 8 & freqs <= 13;\nbeta_idx = freqs > 13 & freqs <= 30;\nplot_idx = freqs >= 1 & freqs <= 40;\n\nalpha_base = zeros(1, num_channels);\nalpha_med = zeros(1, num_channels);\ntheta_base = zeros(1, num_channels);\ntheta_med = zeros(1, num_channels);\nbeta_base = zeros(1, num_channels);\nbeta_med = zeros(1, num_channels);\n\npower_base_all = zeros(num_channels, N/2+1);\npower_med_all = zeros(num_channels, N/2+1);\n\nfor ch = 1:num_channels\n  fft_base = fft(baseline(ch,:));\n  pb = (abs(fft_base(1:N/2+1)).^2) / N;\n  power_base_all(ch,:) = pb;\n\n  fft_med = fft(meditation(ch,:));\n  pm = (abs(fft_med(1:N/2+1)).^2) / N;\n  power_med_all(ch,:) = pm;\n\n  alpha_base(ch) = sum(pb(alpha_idx));\n  alpha_med(ch) = sum(pm(alpha_idx));\n  theta_base(ch) = sum(pb(theta_idx));\n  theta_med(ch) = sum(pm(theta_idx));\n  beta_base(ch) = sum(pb(beta_idx));\n  beta_med(ch) = sum(pm(beta_idx));\nend\n\nalpha_change_pct = (alpha_med - alpha_base) ./ alpha_base * 100;\n\nfigure('Position', [50, 50, 1200, 900]);\n\nsubplot(3,2,1);\nplot(freqs(plot_idx), power_base_all(4, plot_idx), 'b', 'LineWidth', 1.2);\nhold on;\nalpha_plot_idx = freqs >= 8 & freqs <= 13 & plot_idx;\narea_x = freqs(alpha_plot_idx);\narea_y = power_base_all(4, alpha_plot_idx);\nfill([area_x, fliplr(area_x)], [area_y, zeros(1, length(area_y))], [0.7 0.7 1], 'FaceAlpha', 0.5, 'EdgeColor', 'none');\nhold off;\nxlabel('Frequency (Hz)'); ylabel('Power (uV^2)');\ntitle('Baseline Power Spectrum (Oz)');\n\nsubplot(3,2,2);\nplot(freqs(plot_idx), power_med_all(4, plot_idx), 'r', 'LineWidth', 1.2);\nhold on;\narea_y_med = power_med_all(4, alpha_plot_idx);\nfill([area_x, fliplr(area_x)], [area_y_med, zeros(1, length(area_y_med))], [1 0.7 0.7], 'FaceAlpha', 0.5, 'EdgeColor', 'none');\nhold off;\nxlabel('Frequency (Hz)'); ylabel('Power (uV^2)');\ntitle('Meditation Power Spectrum (Oz)');\n\nsubplot(3,2,3);\nalpha_data = [alpha_base; alpha_med]';\nbar(alpha_data);\nset(gca, 'XTickLabel', channel_names);\nylabel('Power (uV^2)');\ntitle('Alpha Power by Channel');\nlegend('Baseline', 'Meditation');\n\nsubplot(3,2,4);\nbar(alpha_change_pct, 'FaceColor', [0.3 0.8 0.3]);\nset(gca, 'XTickLabel', channel_names);\nylabel('Change (%)');\ntitle('Alpha Power Change (%)');\nhold on;\nplot([0.5 4.5], [0 0], 'k--');\nhold off;\n\nsubplot(3,2,5);\nband_base_avg = [mean(theta_base), mean(alpha_base), mean(beta_base)];\nband_med_avg = [mean(theta_med), mean(alpha_med), mean(beta_med)];\nband_data = [band_base_avg; band_med_avg]';\nbar(band_data);\nset(gca, 'XTickLabel', {'Theta', 'Alpha', 'Beta'});\nylabel('Power (uV^2)');\ntitle('Average Band Power');\nlegend('Baseline', 'Meditation');\n\nsubplot(3,2,6);\naxis off;\nmean_alpha_change = round(mean(alpha_change_pct)*10)/10;\n[max_change, max_ch] = max(alpha_change_pct);\ntext(0.1, 0.85, 'Meditation EEG Study Results', 'FontSize', 14, 'FontWeight', 'bold');\ntext(0.1, 0.65, ['Mean alpha power increase: ' num2str(mean_alpha_change) '%'], 'FontSize', 11);\ntext(0.1, 0.45, ['Max increase channel: ' channel_names{max_ch} ' (' num2str(round(max_change*10)/10) '%)'], 'FontSize', 11);\ntext(0.1, 0.25, 'Alpha increase supports meditation hypothesis', 'FontSize', 11);\ntitle('Summary');\n\nsgtitle('Meditation EEG Study: Complete Results');",
      "hints": [
        "Row 1: subplot(3,2,1) for baseline Oz spectrum. Plot with plot(freqs(plot_idx), power_base_all(4, plot_idx)). For shading alpha band, use fill() with the alpha frequency range. Repeat for subplot(3,2,2) with meditation.",
        "Row 2: subplot(3,2,3) for grouped bar of alpha by channel: bar([alpha_base; alpha_med]'). subplot(3,2,4) for percentage change: bar(alpha_change_pct, 'FaceColor', [0.3 0.8 0.3]); add plot([0.5 4.5], [0 0], 'k--') for zero line.",
        "Row 3: subplot(3,2,5) for band averages. subplot(3,2,6): axis off; then use text(x, y, 'string') to place summary text. mean_alpha_change = round(mean(alpha_change_pct)*10)/10; [~,max_ch] = max(alpha_change_pct);"
      ],
      "test_cases": [],
      "requires_plot": true
    }
  ]
}
