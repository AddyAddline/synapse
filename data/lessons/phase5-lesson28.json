{
  "phase": 5,
  "order_num": 5,
  "title": "Cross-Modal Neuroscience Capstone",
  "description": "Load multiple real datasets, compare analysis techniques across recording modalities, and synthesize everything you have learned.",
  "difficulty": "advanced",
  "estimated_minutes": 60,
  "content_md": "# Cross-Modal Neuroscience Capstone\n\nThis is the **final lesson** of Synapse. You have gone from `disp('Hello, World!')` to analyzing real brain data. Now you will bring it all together.\n\nIn this capstone, you will work with **multiple real datasets simultaneously** — comparing how we analyze neural data across different recording techniques.\n\n## The Big Picture\n\nEach recording technique gives you a different window into the brain:\n\n| Technique | Scale | What You See |\n|-----------|-------|--------------|\n| **Spike recordings** | Single neurons | When individual neurons fire |\n| **EEG** | Whole brain (surface) | Aggregate electrical rhythms |\n| **fMRI** | Whole brain (3D) | Which regions are active |\n| **Calcium imaging** | Hundreds of neurons | Population activity patterns |\n\nNo single technique tells the whole story. Modern neuroscience often combines multiple modalities.\n\n## What You Will Do\n\n1. Load all four datasets\n2. Apply the appropriate analysis to each\n3. Compare results across modalities\n4. Create a summary visualization\n\n## Reflection\n\nThink about what you have learned:\n- **Phase 1:** MATLAB basics — variables, loops, arrays, functions\n- **Phase 2:** Data manipulation — matrices, plotting, file I/O\n- **Phase 3:** Signal processing — FFT, filtering, spectrograms\n- **Phase 4:** Neuroscience — EEG, ERPs, spectral analysis, source localization concepts\n- **Phase 5:** Real data — spikes, EEG, fMRI, calcium imaging\n\nYou now have the skills to start analyzing real data in a neuroscience lab. Let's finish strong!",
  "exercises": [
    {
      "order_num": 1,
      "title": "Multi-modal data inventory",
      "prompt": "Load all four neuroscience datasets and create an inventory of what each contains.\n\n1. Load all four files:\n   - spike_data.mat\n   - ssvep_data.mat\n   - fmri_data.mat\n   - calcium_data.mat\n2. For each dataset, display:\n   - Dataset name\n   - Number of fields\n   - For the largest numeric field: name, dimensions, value range (min/max), data type\n3. Create a summary comparison:\n   disp('=== Cross-Modal Comparison ===')\n   For each dataset, display one line:\n   '[Dataset]: [largest field size] | range: [min] to [max]'\n4. Display the total memory usage: sum up numel * 8 bytes (assuming double) for all numeric fields across all four datasets. Display in MB:\n   disp(['Total data size: ' num2str(total_bytes / 1e6, '%.1f') ' MB'])",
      "starter_code": "% Cross-modal data inventory\nNEURO_DATA = '/usr/share/neuroscience-data';\n\n% Load all four datasets\ndatasets = struct();\ndatasets.spikes = load([NEURO_DATA '/spike_data.mat']);\ndatasets.ssvep = load([NEURO_DATA '/ssvep_data.mat']);\ndatasets.fmri = load([NEURO_DATA '/fmri_data.mat']);\ndatasets.calcium = load([NEURO_DATA '/calcium_data.mat']);\n\nnames = fieldnames(datasets);\n\n% Analyze each dataset\n% YOUR CODE HERE\n\n% Summary comparison\ndisp('=== Cross-Modal Comparison ===');\n% YOUR CODE HERE\n\n% Total memory\n% YOUR CODE HERE\n",
      "solution": "NEURO_DATA = '/usr/share/neuroscience-data';\n\ndatasets = struct();\ndatasets.spikes = load([NEURO_DATA '/spike_data.mat']);\ndatasets.ssvep = load([NEURO_DATA '/ssvep_data.mat']);\ndatasets.fmri = load([NEURO_DATA '/fmri_data.mat']);\ndatasets.calcium = load([NEURO_DATA '/calcium_data.mat']);\n\nnames = fieldnames(datasets);\ntotal_bytes = 0;\nsummary_info = {};\n\nfor d = 1:length(names)\n  dname = names{d};\n  ds = datasets.(dname);\n  fnames = fieldnames(ds);\n\n  disp(['=== ' upper(dname) ' ===']);\n  disp(['Fields: ' num2str(length(fnames))]);\n\n  max_numel = 0;\n  largest_name = '';\n  largest_val = [];\n\n  for i = 1:length(fnames)\n    val = ds.(fnames{i});\n    if isnumeric(val)\n      total_bytes = total_bytes + numel(val) * 8;\n      if numel(val) > max_numel\n        max_numel = numel(val);\n        largest_name = fnames{i};\n        largest_val = val;\n      end\n    end\n  end\n\n  if ~isempty(largest_val)\n    disp(['  Largest: ' largest_name ' | size: ' num2str(size(largest_val)) ...\n      ' | range: ' num2str(min(largest_val(:))) ' to ' num2str(max(largest_val(:))) ...\n      ' | class: ' class(largest_val)]);\n    summary_info{d} = [dname ': ' num2str(size(largest_val)) ...\n      ' | range: ' num2str(min(largest_val(:)), '%.2f') ...\n      ' to ' num2str(max(largest_val(:)), '%.2f')];\n  end\n  disp('');\nend\n\ndisp('=== Cross-Modal Comparison ===');\nfor d = 1:length(summary_info)\n  disp(summary_info{d});\nend\n\ndisp('');\ndisp(['Total data size: ' num2str(total_bytes / 1e6, '%.1f') ' MB']);",
      "hints": [
        "Use a struct with named fields to organize all four datasets: datasets.spikes, datasets.ssvep, etc.",
        "Loop through dataset names with fieldnames(datasets), then through each dataset's fields with fieldnames(ds).",
        "Memory: numel(val) * 8 gives bytes for double arrays. Sum across all numeric fields."
      ],
      "test_cases": [],
      "requires_plot": false
    },
    {
      "order_num": 2,
      "title": "Cross-modal analysis comparison",
      "prompt": "Perform a characteristic analysis on each dataset and display the key finding.\n\n1. Load all four datasets\n2. For each, apply the appropriate analysis:\n\n   **Spikes:** Find the largest numeric field. Compute the mean firing rate (mean of all values). Display: 'Spikes — Mean response: [value]'\n\n   **SSVEP:** Find the largest 2D field. Extract channel 1. Compute FFT, find peak frequency between 5-50 Hz (assume fs=1000 if no scalar field). Display: 'SSVEP — Peak frequency: [freq] Hz'\n\n   **fMRI:** Find the largest field. Extract a single time series (center voxel for 4D, first row/col for 2D, limit to 200 points). Compute the standard deviation of percent signal change. Display: 'fMRI — PSC std dev: [value]%'\n\n   **Calcium:** Find the largest 2D field. Compute dF/F for the first trace. Count threshold crossings (2 std above mean). Display: 'Calcium — Detected events: [N] (neuron 1)'\n\n3. Display all results in a summary block with a header:\n   '=== Key Findings Across Modalities ==='",
      "starter_code": "% Cross-modal analysis comparison\nNEURO_DATA = '/usr/share/neuroscience-data';\n\ndatasets = struct();\ndatasets.spikes = load([NEURO_DATA '/spike_data.mat']);\ndatasets.ssvep = load([NEURO_DATA '/ssvep_data.mat']);\ndatasets.fmri = load([NEURO_DATA '/fmri_data.mat']);\ndatasets.calcium = load([NEURO_DATA '/calcium_data.mat']);\n\nresults = {};\n\n% --- Spike analysis ---\n% YOUR CODE HERE\n\n% --- SSVEP analysis ---\n% YOUR CODE HERE\n\n% --- fMRI analysis ---\n% YOUR CODE HERE\n\n% --- Calcium analysis ---\n% YOUR CODE HERE\n\n% Display summary\ndisp('=== Key Findings Across Modalities ===');\nfor i = 1:length(results)\n  disp(results{i});\nend\n",
      "solution": "NEURO_DATA = '/usr/share/neuroscience-data';\n\ndatasets = struct();\ndatasets.spikes = load([NEURO_DATA '/spike_data.mat']);\ndatasets.ssvep = load([NEURO_DATA '/ssvep_data.mat']);\ndatasets.fmri = load([NEURO_DATA '/fmri_data.mat']);\ndatasets.calcium = load([NEURO_DATA '/calcium_data.mat']);\n\nresults = {};\n\n% Helper: find largest numeric field\nfunction [name, val] = find_largest(ds)\n  fnames = fieldnames(ds);\n  max_n = 0; name = ''; val = [];\n  for i = 1:length(fnames)\n    v = ds.(fnames{i});\n    if isnumeric(v) && numel(v) > max_n\n      max_n = numel(v); name = fnames{i}; val = v;\n    end\n  end\nend\n\n% --- Spikes ---\n[~, spike_val] = find_largest(datasets.spikes);\nmean_rate = mean(spike_val(:));\nresults{end+1} = ['Spikes - Mean response: ' num2str(mean_rate, '%.4f')];\n\n% --- SSVEP ---\nds = datasets.ssvep;\nfnames = fieldnames(ds);\nfs_eeg = 1000;\nfor i = 1:length(fnames)\n  v = ds.(fnames{i});\n  if isnumeric(v) && isscalar(v) && v > 0\n    fs_eeg = v; break;\n  end\nend\n[~, eeg_val] = find_largest(ds);\n[r, c] = size(eeg_val);\nif r < c\n  ch1 = eeg_val(1,:);\nelse\n  ch1 = eeg_val(:,1)';\nend\nN = length(ch1);\nfft_r = fft(ch1);\npow = abs(fft_r(1:N/2+1)).^2 / N;\nfreqs = (0:N/2) * fs_eeg / N;\nsearch = freqs >= 5 & freqs <= 50;\npow_search = pow; pow_search(~search) = 0;\n[~, pk] = max(pow_search);\nresults{end+1} = ['SSVEP - Peak frequency: ' num2str(freqs(pk), '%.1f') ' Hz'];\n\n% --- fMRI ---\n[~, fmri_val] = find_largest(datasets.fmri);\nnd = ndims(fmri_val);\nif nd > 2\n  cx = round(size(fmri_val,1)/2);\n  cy = round(size(fmri_val,2)/2);\n  cz = round(size(fmri_val,3)/2);\n  ts = squeeze(fmri_val(cx,cy,cz,:))';\nelse\n  [r,c] = size(fmri_val);\n  if r < c, ts = fmri_val(1,:); else ts = fmri_val(:,1)'; end\nend\nif length(ts) > 200, ts = ts(1:200); end\npsc = (ts - mean(ts)) / mean(ts) * 100;\nresults{end+1} = ['fMRI - PSC std dev: ' num2str(std(psc), '%.2f') '%'];\n\n% --- Calcium ---\n[~, ca_val] = find_largest(datasets.calcium);\n[r,c] = size(ca_val);\nif r > c, ca_val = ca_val'; end\nF = ca_val(1,:);\nF0 = mean(F);\ndff = (F - F0) / F0;\nthresh = mean(dff) + 2*std(dff);\nrising = diff([0 (dff > thresh)]) == 1;\nresults{end+1} = ['Calcium - Detected events: ' num2str(sum(rising)) ' (neuron 1)'];\n\ndisp('=== Key Findings Across Modalities ===');\nfor i = 1:length(results)\n  disp(results{i});\nend",
      "hints": [
        "Create a helper function to find the largest numeric field — you will reuse it for all four datasets.",
        "For SSVEP: same FFT + peak-finding approach from Lesson 22. For fMRI: same center-voxel extraction from Lesson 23.",
        "For calcium: same dF/F + threshold detection from Lesson 24. Use diff([0 mask]) == 1 for rising edges."
      ],
      "test_cases": [],
      "requires_plot": false
    },
    {
      "order_num": 3,
      "title": "Final capstone visualization",
      "prompt": "Create a final multi-panel figure comparing all four modalities.\n\n1. Load all four datasets and perform the analyses from Exercise 2\n2. Create a 2×2 figure (figure position: [50, 50, 1200, 800]):\n\n   **Panel (1,1) — Spikes:** Plot the mean response profile (mean across first dimension of the largest field). Title: 'Spike Data: Mean Response'. ylabel: 'Response'. xlabel: 'Index'.\n\n   **Panel (1,2) — SSVEP:** Plot the power spectrum (1-60 Hz) of channel 1. Title: 'SSVEP: Power Spectrum (Ch 1)'. ylabel: 'Power'. xlabel: 'Frequency (Hz)'.\n\n   **Panel (2,1) — fMRI:** Plot the percent signal change time series. Title: 'fMRI: Percent Signal Change'. ylabel: '% Change'. xlabel: 'Time Point'.\n\n   **Panel (2,2) — Calcium:** Plot the dF/F trace of neuron 1 with threshold line and event markers. Title: 'Calcium: dF/F with Events'. ylabel: 'dF/F'. xlabel: 'Frame'.\n\n3. Main title: 'Synapse Capstone: Four Modalities of Neural Data'\n4. After the figure, display a congratulations message:\n   disp('Congratulations! You have completed all 25 lessons of Synapse.')\n   disp('You can now analyze real neuroscience data in MATLAB.')",
      "starter_code": "% Final Capstone Visualization\nNEURO_DATA = '/usr/share/neuroscience-data';\n\n% Load all datasets\nspikes = load([NEURO_DATA '/spike_data.mat']);\nssvep = load([NEURO_DATA '/ssvep_data.mat']);\nfmri_ds = load([NEURO_DATA '/fmri_data.mat']);\ncalcium = load([NEURO_DATA '/calcium_data.mat']);\n\n% Helper: find largest numeric field\nfunction [name, val] = find_largest(ds)\n  fnames = fieldnames(ds);\n  max_n = 0; name = ''; val = [];\n  for i = 1:length(fnames)\n    v = ds.(fnames{i});\n    if isnumeric(v) && numel(v) > max_n\n      max_n = numel(v); name = fnames{i}; val = v;\n    end\n  end\nend\n\nfigure('Position', [50, 50, 1200, 800]);\n\n% Panel 1: Spikes\n% YOUR CODE HERE\n\n% Panel 2: SSVEP\n% YOUR CODE HERE\n\n% Panel 3: fMRI\n% YOUR CODE HERE\n\n% Panel 4: Calcium\n% YOUR CODE HERE\n\nsgtitle('Synapse Capstone: Four Modalities of Neural Data');\n\ndisp('Congratulations! You have completed all 25 lessons of Synapse.');\ndisp('You can now analyze real neuroscience data in MATLAB.');\n",
      "solution": "NEURO_DATA = '/usr/share/neuroscience-data';\n\nspikes = load([NEURO_DATA '/spike_data.mat']);\nssvep = load([NEURO_DATA '/ssvep_data.mat']);\nfmri_ds = load([NEURO_DATA '/fmri_data.mat']);\ncalcium = load([NEURO_DATA '/calcium_data.mat']);\n\nfunction [name, val] = find_largest(ds)\n  fnames = fieldnames(ds);\n  max_n = 0; name = ''; val = [];\n  for i = 1:length(fnames)\n    v = ds.(fnames{i});\n    if isnumeric(v) && numel(v) > max_n\n      max_n = numel(v); name = fnames{i}; val = v;\n    end\n  end\nend\n\nfigure('Position', [50, 50, 1200, 800]);\n\n% Panel 1: Spikes\nsubplot(2,2,1);\n[~, spike_val] = find_largest(spikes);\nmean_spike = mean(spike_val, 1);\nplot(mean_spike, 'b-', 'LineWidth', 1.2);\nxlabel('Index');\nylabel('Response');\ntitle('Spike Data: Mean Response');\n\n% Panel 2: SSVEP\nsubplot(2,2,2);\nfnames = fieldnames(ssvep);\nfs_eeg = 1000;\nfor i = 1:length(fnames)\n  v = ssvep.(fnames{i});\n  if isnumeric(v) && isscalar(v) && v > 0\n    fs_eeg = v; break;\n  end\nend\n[~, eeg_val] = find_largest(ssvep);\n[r, c] = size(eeg_val);\nif r < c, ch1 = eeg_val(1,:); else ch1 = eeg_val(:,1)'; end\nN = length(ch1);\nfft_r = fft(ch1);\npow = abs(fft_r(1:N/2+1)).^2 / N;\nfreqs = (0:N/2) * fs_eeg / N;\nidx = freqs >= 1 & freqs <= 60;\nplot(freqs(idx), pow(idx), 'r-', 'LineWidth', 1.2);\nxlabel('Frequency (Hz)');\nylabel('Power');\ntitle('SSVEP: Power Spectrum (Ch 1)');\n\n% Panel 3: fMRI\nsubplot(2,2,3);\n[~, fmri_val] = find_largest(fmri_ds);\nnd = ndims(fmri_val);\nif nd > 2\n  cx = round(size(fmri_val,1)/2);\n  cy = round(size(fmri_val,2)/2);\n  cz = round(size(fmri_val,3)/2);\n  ts = squeeze(fmri_val(cx,cy,cz,:))';\nelse\n  [r,c] = size(fmri_val);\n  if r < c, ts = fmri_val(1,:); else ts = fmri_val(:,1)'; end\nend\nif length(ts) > 200, ts = ts(1:200); end\npsc = (ts - mean(ts)) / mean(ts) * 100;\nplot(psc, 'Color', [0.2 0.6 0.2], 'LineWidth', 1.2);\nhold on;\nplot([1 length(psc)], [0 0], 'k--');\nhold off;\nxlabel('Time Point');\nylabel('% Change');\ntitle('fMRI: Percent Signal Change');\n\n% Panel 4: Calcium\nsubplot(2,2,4);\n[~, ca_val] = find_largest(calcium);\n[r,c] = size(ca_val);\nif r > c, ca_val = ca_val'; end\nF = ca_val(1,:);\nF0 = mean(F);\ndff = (F - F0) / F0;\nthresh = mean(dff) + 2*std(dff);\nrising = diff([0 (dff > thresh)]) == 1;\nevents = find(rising);\n\nplot(dff, 'm-', 'LineWidth', 0.8);\nhold on;\nplot([1 length(dff)], [thresh thresh], 'k--', 'LineWidth', 1);\nif ~isempty(events)\n  plot(events, dff(events), 'kv', 'MarkerSize', 5, 'MarkerFaceColor', 'k');\nend\nhold off;\nxlabel('Frame');\nylabel('dF/F');\ntitle('Calcium: dF/F with Events');\n\nsgtitle('Synapse Capstone: Four Modalities of Neural Data');\n\ndisp('Congratulations! You have completed all 25 lessons of Synapse.');\ndisp('You can now analyze real neuroscience data in MATLAB.');",
      "hints": [
        "Reuse the find_largest helper for all four datasets. Each panel applies the same analysis from Exercises in Lessons 21-24.",
        "For spikes: mean(spike_val, 1) averages across trials. For SSVEP: FFT of channel 1.",
        "For fMRI: extract center voxel, compute PSC. For calcium: dF/F + threshold + event detection."
      ],
      "test_cases": [],
      "requires_plot": true
    }
  ]
}
